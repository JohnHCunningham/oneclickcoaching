<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revenue Factory - Manager Performance Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Confetti Animation Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --brand-navy: #0C1030;
            --brand-teal: #10C3B0;
            --brand-aqua: #3DE0D2;
            --brand-pink: #E64563;
            --brand-gold: #F4B03A;
            --light-text: #F2F4F8;
            --card-bg: #131a40;
            --success-green: #10C3B0;
            --warning-yellow: #F9C863;
            --danger-red: #E64563;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, var(--brand-navy) 0%, #050816 100%);
            color: var(--light-text);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Header */
        .dashboard-header {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(61, 224, 210, 0.1);
        }

        .dashboard-header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--brand-aqua), var(--brand-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .team-stats {
            display: flex;
            gap: 30px;
            color: var(--brand-gold);
            font-size: 0.95rem;
        }

        .team-stats span {
            opacity: 0.9;
        }

        /* View Toggle */
        .view-toggle {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 20px;
        }

        .toggle-btn {
            padding: 10px 20px;
            border: 1px solid var(--brand-teal);
            background: rgba(61, 224, 210, 0.1);
            color: var(--brand-aqua);
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.2s ease;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, var(--brand-teal), var(--brand-aqua));
            color: white;
        }

        .toggle-btn:hover {
            transform: translateY(-2px);
        }

        .view-container {
            display: none;
        }

        .view-container.active {
            display: block;
        }

        /* Rep Grid */
        .rep-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 25px;
        }

        /* Table View */
        .table-container {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(61, 224, 210, 0.1);
            overflow-x: auto;
        }

        .performance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .performance-table th {
            background: rgba(61, 224, 210, 0.1);
            padding: 15px;
            text-align: left;
            font-weight: 700;
            color: var(--brand-aqua);
            border-bottom: 2px solid var(--brand-teal);
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }

        .performance-table th:hover {
            background: rgba(61, 224, 210, 0.2);
        }

        .performance-table th::after {
            content: ' ‚áÖ';
            opacity: 0.3;
            font-size: 0.8em;
        }

        .performance-table th.sorted-asc::after {
            content: ' ‚Üë';
            opacity: 1;
        }

        .performance-table th.sorted-desc::after {
            content: ' ‚Üì';
            opacity: 1;
        }

        .performance-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .performance-table tr:hover {
            background: rgba(61, 224, 210, 0.05);
        }

        .performance-table tr.row-critical {
            background: rgba(230, 69, 99, 0.1);
        }

        .performance-table tr.row-watch {
            background: rgba(249, 200, 99, 0.05);
        }

        .performance-table tr.row-healthy {
            background: rgba(16, 195, 176, 0.05);
        }

        .table-rep-name {
            font-weight: 700;
            color: var(--brand-aqua);
            font-size: 1.05rem;
        }

        .table-methodology {
            font-size: 0.85rem;
            color: var(--brand-gold);
            opacity: 0.8;
        }

        .table-metric {
            font-weight: 700;
            text-align: center;
        }

        .table-metric.good {
            color: var(--success-green);
        }

        .table-metric.warning {
            color: var(--warning-yellow);
        }

        .table-metric.bad {
            color: var(--danger-red);
        }

        .table-vs-avg {
            display: block;
            font-size: 0.75rem;
            opacity: 0.7;
            font-weight: 400;
        }

        .table-status {
            text-align: center;
            font-size: 1.5rem;
        }

        .table-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .table-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .table-btn-coach {
            background: linear-gradient(135deg, var(--brand-teal), var(--brand-aqua));
            color: white;
        }

        .table-btn-coach.urgent {
            background: linear-gradient(135deg, var(--danger-red), #c13752);
        }

        .table-btn-details {
            background: rgba(61, 224, 210, 0.2);
            color: var(--brand-aqua);
            border: 1px solid var(--brand-teal);
        }

        .table-btn:hover {
            transform: scale(1.05);
        }

        /* Rep Card */
        .rep-card {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 2px solid rgba(61, 224, 210, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .rep-card.status-healthy {
            border-color: var(--success-green);
        }

        .rep-card.status-watch {
            border-color: var(--warning-yellow);
            animation: pulse-yellow 2s infinite;
        }

        .rep-card.status-critical {
            border-color: var(--danger-red);
            animation: pulse-red 2s infinite;
        }

        .rep-card.coached-unread {
            border-color: #FF8C42;
            background: linear-gradient(135deg, rgba(255, 140, 66, 0.05), rgba(230, 69, 99, 0.05));
        }

        .rep-card.coached-read {
            opacity: 0.6;
        }

        @keyframes pulse-yellow {
            0%, 100% { box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 10px 40px rgba(249, 200, 99, 0.4); }
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 10px 40px rgba(230, 69, 99, 0.6); }
        }

        /* Rep Header */
        .rep-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .rep-info h3 {
            font-size: 1.4rem;
            color: var(--brand-aqua);
            margin-bottom: 5px;
        }

        .rep-methodology {
            font-size: 0.85rem;
            color: var(--brand-gold);
            opacity: 0.8;
        }

        .status-indicator {
            font-size: 2.5rem;
            line-height: 1;
        }

        /* Radial Rings Container */
        .radial-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 25px 0;
            position: relative;
        }

        .radial-canvas {
            display: block;
        }

        /* Metrics Display */
        .metrics-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }

        .metric-label {
            font-size: 0.85rem;
            color: rgba(242, 244, 248, 0.7);
        }

        .metric-value {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .metric-value.good {
            color: var(--success-green);
        }

        .metric-value.warning {
            color: var(--warning-yellow);
        }

        .metric-value.bad {
            color: var(--danger-red);
        }

        .metric-vs-avg {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-left: 8px;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }

        .btn-coach {
            background: linear-gradient(135deg, var(--brand-teal), var(--brand-aqua));
            color: white;
        }

        .btn-coach.urgent {
            background: linear-gradient(135deg, var(--danger-red), #c13752);
            animation: pulse-button 2s infinite;
        }

        .btn-coached-unread {
            background: linear-gradient(135deg, #FF8C42, #FF6B35);
            color: white;
        }

        .btn-coached-read {
            background: rgba(61, 224, 210, 0.2);
            color: var(--brand-aqua);
            border: 1px solid var(--brand-teal);
        }

        @keyframes pulse-button {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .btn-details {
            background: linear-gradient(135deg, rgba(61, 224, 210, 0.2), rgba(16, 195, 176, 0.2));
            border: 1px solid var(--brand-teal);
            color: var(--brand-aqua);
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        /* Coaching Status */
        .coaching-status {
            text-align: center;
            font-size: 0.8rem;
            margin-top: 10px;
            padding: 8px;
            border-radius: 8px;
        }

        .coaching-status.unread {
            background: rgba(255, 140, 66, 0.2);
            color: #FF8C42;
        }

        .coaching-status.read {
            color: rgba(242, 244, 248, 0.5);
        }

        /* Legend */
        .legend {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(61, 224, 210, 0.1);
        }

        .legend h3 {
            color: var(--brand-gold);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid;
        }

        .legend-text {
            font-size: 0.9rem;
            color: rgba(242, 244, 248, 0.8);
        }

        /* Achievement Badges */
        .achievement-badges {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 5px;
            z-index: 10;
        }

        .badge {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid;
            background: var(--card-bg);
        }

        .badge.streak {
            border-color: #FF6B35;
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        .badge.mastery {
            border-color: var(--brand-gold);
            box-shadow: 0 0 10px rgba(244, 176, 58, 0.3);
        }

        .badge.personal-best {
            border-color: var(--brand-aqua);
            box-shadow: 0 0 10px rgba(61, 224, 210, 0.3);
        }

        .badge.first-win {
            border-color: var(--success-green);
            box-shadow: 0 0 10px rgba(16, 195, 176, 0.3);
        }

        .badge:hover {
            transform: scale(1.15);
            box-shadow: 0 0 20px currentColor;
        }

        /* Celebration Modal */
        .celebration-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .celebration-modal.active {
            display: flex;
        }

        .celebration-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            text-align: center;
            border: 2px solid var(--brand-teal);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .celebration-content::-webkit-scrollbar {
            width: 8px;
        }

        .celebration-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .celebration-content::-webkit-scrollbar-thumb {
            background: var(--brand-teal);
            border-radius: 10px;
        }

        .celebration-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .celebration-title {
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--brand-aqua), var(--brand-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            font-weight: 900;
        }

        .celebration-description {
            font-size: 1.05rem;
            color: var(--brand-gold);
            line-height: 1.6;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .celebration-details {
            background: rgba(61, 224, 210, 0.05);
            border: 1px solid rgba(61, 224, 210, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: rgba(242, 244, 248, 0.9);
            text-align: left;
            line-height: 1.7;
            white-space: pre-wrap;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        .celebration-close {
            background: linear-gradient(135deg, var(--brand-teal), var(--brand-aqua));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .celebration-close:hover {
            transform: translateY(-2px);
        }

        /* Team Celebration Feed */
        .celebration-feed {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(61, 224, 210, 0.1);
        }

        .celebration-feed h2 {
            color: var(--brand-gold);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .celebration-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 15px;
            border-left: 4px solid;
            transition: all 0.2s ease;
        }

        .celebration-item:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateX(5px);
        }

        .celebration-item.level-1 {
            border-left-color: var(--brand-aqua);
        }

        .celebration-item.level-2 {
            border-left-color: var(--brand-gold);
        }

        .celebration-item.level-3 {
            border-left-color: #FF6B35;
        }

        .celebration-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .celebration-item-title {
            font-weight: 700;
            font-size: 1.05rem;
            color: var(--brand-aqua);
        }

        .celebration-item-time {
            font-size: 0.85rem;
            color: rgba(242, 244, 248, 0.5);
        }

        .celebration-item-description {
            color: rgba(242, 244, 248, 0.8);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .celebration-item-icon {
            font-size: 1.3rem;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <div>
                    <h1>The Revenue Factory</h1>
                    <div class="team-stats">
                        <span>üìä Team Average: 50 dials ‚Ä¢ 15 conversations ‚Ä¢ 5 meetings ‚Ä¢ 2 sales</span>
                        <span>üìÖ Last 7 Days</span>
                    </div>
                </div>
                <a href="index.html" style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, rgba(61, 224, 210, 0.2), rgba(16, 195, 176, 0.2)); border: 1px solid var(--brand-teal); color: var(--brand-aqua); text-decoration: none; border-radius: 25px; font-weight: 700; transition: all 0.2s ease;">
                    üè† My Dashboard
                </a>
            </div>
        </div>

        <!-- View Toggle -->
        <div class="view-toggle">
            <button class="toggle-btn active" onclick="switchView('cards')">üìä Card View</button>
            <button class="toggle-btn" onclick="switchView('table')">üìã Table View</button>
            <button class="toggle-btn" onclick="refreshHubSpotData()" id="sync-btn">üîÑ Sync HubSpot</button>
        </div>

        <!-- HubSpot Live Stats -->
        <div class="hubspot-stats" id="hubspot-stats" style="display: none; background: linear-gradient(135deg, #1a2555, #131a40); border-radius: 15px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(16, 195, 176, 0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="color: #10C3B0; margin: 0;">üì° Live HubSpot Data</h3>
                <span id="last-sync-time" style="color: rgba(255,255,255,0.5); font-size: 0.85rem;"></span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                <div style="background: rgba(16, 195, 176, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #10C3B0;" id="hubspot-calls">0</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">üìû Calls</div>
                </div>
                <div style="background: rgba(61, 224, 210, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #3DE0D2;" id="hubspot-emails">0</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">üìß Emails</div>
                </div>
                <div style="background: rgba(244, 176, 58, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #F4B03A;" id="hubspot-meetings">0</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">üìÖ Meetings</div>
                </div>
                <div style="background: rgba(230, 69, 99, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #E64563;" id="hubspot-tasks">0</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">‚úÖ Tasks</div>
                </div>
            </div>
        </div>

        <!-- Fathom Live Stats -->
        <div class="fathom-stats" id="fathom-stats" style="display: none; background: linear-gradient(135deg, #2a1a55, #1a1040); border-radius: 15px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(147, 51, 234, 0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="color: #9333EA; margin: 0;">üéôÔ∏è Fathom Call Recordings</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span id="fathom-sync-time" style="color: rgba(255,255,255,0.5); font-size: 0.85rem;"></span>
                    <button onclick="refreshFathomData()" id="fathom-sync-btn" style="padding: 8px 15px; background: rgba(147, 51, 234, 0.2); border: 1px solid #9333EA; color: #9333EA; border-radius: 8px; cursor: pointer;">üîÑ Sync</button>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                <div style="background: rgba(147, 51, 234, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #9333EA;" id="fathom-calls">0</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">üé• Recorded Calls</div>
                </div>
                <div style="background: rgba(147, 51, 234, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #A855F7;" id="fathom-transcripts">0</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">üìù Transcripts</div>
                </div>
                <div style="background: rgba(147, 51, 234, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #C084FC;" id="fathom-summaries">0</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">ü§ñ AI Summaries</div>
                </div>
            </div>
        </div>

        <!-- Aircall Live Stats -->
        <div class="aircall-stats" id="aircall-stats" style="display: none; background: linear-gradient(135deg, #1a3a2a, #102a1a); border-radius: 15px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(34, 197, 94, 0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="color: #22C55E; margin: 0;">üìû Aircall Phone Calls</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span id="aircall-sync-time" style="color: rgba(255,255,255,0.5); font-size: 0.85rem;"></span>
                    <button onclick="refreshAircallData()" id="aircall-sync-btn" style="padding: 8px 15px; background: rgba(34, 197, 94, 0.2); border: 1px solid #22C55E; color: #22C55E; border-radius: 8px; cursor: pointer;">üîÑ Sync</button>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                <div style="background: rgba(34, 197, 94, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #22C55E;" id="aircall-total">0</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">üìû Total Calls</div>
                </div>
                <div style="background: rgba(34, 197, 94, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #4ADE80;" id="aircall-recordings">0</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">üéôÔ∏è Recordings</div>
                </div>
                <div style="background: rgba(34, 197, 94, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: bold; color: #86EFAC;" id="aircall-minutes">0</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">‚è±Ô∏è Total Minutes</div>
                </div>
            </div>
        </div>

        <!-- Card View Container -->
        <div class="view-container active" id="card-view">
            <div class="rep-grid" id="rep-grid"></div>
        </div>

        <!-- Table View Container -->
        <div class="view-container" id="table-view">
            <div class="table-container">
                <h2 style="color: var(--brand-gold); margin-bottom: 15px;">Team Performance Table</h2>
                <table class="performance-table" id="performance-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable('name')">Rep Name</th>
                            <th onclick="sortTable('methodology')">Methodology</th>
                            <th onclick="sortTable('status')">Status</th>
                            <th onclick="sortTable('dials')">Dials</th>
                            <th onclick="sortTable('conversations')">Conversations</th>
                            <th onclick="sortTable('meetings')">Meetings</th>
                            <th onclick="sortTable('sales')">Sales</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <h3>Performance Rings Guide</h3>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color" style="border-color: var(--success-green); background: rgba(16, 195, 176, 0.2);"></div>
                    <div class="legend-text"><strong>Ring 1 (Outer):</strong> Dials</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="border-color: var(--brand-aqua); background: rgba(61, 224, 210, 0.2);"></div>
                    <div class="legend-text"><strong>Ring 2:</strong> Conversations</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="border-color: var(--brand-gold); background: rgba(244, 176, 58, 0.2);"></div>
                    <div class="legend-text"><strong>Ring 3:</strong> Meetings</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="border-color: var(--brand-pink); background: rgba(230, 69, 99, 0.2);"></div>
                    <div class="legend-text"><strong>Ring 4 (Center):</strong> Sales</div>
                </div>
            </div>
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); color: rgba(242, 244, 248, 0.6); font-size: 0.85rem;">
                <strong>Status Indicators:</strong> üü¢ Healthy (all metrics ‚â•75%) ‚Ä¢ üü° Watch (any metric 50-74%) ‚Ä¢ üî¥ Critical (any metric &lt;50%)
            </div>
        </div>

        <!-- Team Celebration Feed -->
        <div class="celebration-feed">
            <h2>üéâ Recent Team Wins</h2>
            <div id="celebration-feed-items"></div>
        </div>
    </div>

    <!-- Celebration Modal -->
    <div class="celebration-modal" id="celebration-modal">
        <div class="celebration-content">
            <div class="celebration-icon" id="modal-icon">üéâ</div>
            <div class="celebration-title" id="modal-title">Achievement Unlocked!</div>
            <div class="celebration-description" id="modal-description"></div>
            <div class="celebration-details" id="modal-details"></div>
            <button class="celebration-close" onclick="closeCelebrationModal()">Awesome!</button>
        </div>
    </div>

    <script>
        // ============================================
        // DEMO DATA (Industry Standard Ratios)
        // ============================================

        const TEAM_AVERAGE = {
            dials: 50,
            conversations: 15,
            meetings: 5,
            sales: 2
        };

        const EXPECTED_BASELINES = {
            dials: 50,
            conversations: 15,  // 30% of dials
            meetings: 5,        // 33% of conversations
            sales: 2            // 40% of meetings
        };

        // Static demo data for presentation
        const demoReps = [
            {
                id: 1,
                name: "Sarah Johnson",
                methodology: "Sandler",
                dials: 65,
                conversations: 20,
                meetings: 7,
                sales: 3,
                coachingStatus: null,
                achievements: [
                    {
                        type: 'streak',
                        icon: 'üî•üî•',
                        title: '10-Day Activity Streak',
                        description: 'Sarah has hit her daily baseline for 10 consecutive days!',
                        details: '65 dials this week - her highest ever. Consistency is the foundation of success.',
                        level: 2
                    },
                    {
                        type: 'personal-best',
                        icon: '‚≠ê',
                        title: 'Personal Best - Most Dials',
                        description: '65 dials this week = 130% of baseline',
                        details: 'This is Sarah\'s highest activity week since joining the team.',
                        level: 1
                    }
                ]
            },
            {
                id: 2,
                name: "Mike Chen",
                methodology: "MEDDIC",
                dials: 48,
                conversations: 14,
                meetings: 5,
                sales: 2,
                coachingStatus: null,
                achievements: [
                    {
                        type: 'first-win',
                        icon: 'üèÜ',
                        title: 'First Sale Closed!',
                        description: 'Mike just closed his first deal - $25,000!',
                        details: 'Deal: TechCorp Solutions\nFrom first call to close: 14 days\nMEDDIC executed with precision ‚úÖ',
                        level: 2
                    }
                ]
            },
            {
                id: 3,
                name: "Lisa Park",
                methodology: "Challenger",
                dials: 22,
                conversations: 6,
                meetings: 2,
                sales: 0,
                coachingStatus: { read: false, sentAt: "2 hours ago" },
                achievements: [
                    {
                        type: 'first-win',
                        icon: 'üí¨',
                        title: 'First Coaching Received',
                        description: 'Lisa is taking her first step toward improvement',
                        details: 'Every journey starts with awareness. We celebrate every step forward.',
                        level: 1
                    }
                ]
            },
            {
                id: 4,
                name: "Tom Williams",
                methodology: "SPIN",
                dials: 58,
                conversations: 18,
                meetings: 6,
                sales: 3,
                coachingStatus: { read: true, sentAt: "1 day ago" },
                achievements: [
                    {
                        type: 'mastery',
                        icon: 'üèÜ',
                        title: 'SPIN Methodology Master',
                        description: 'Tom unlocked SPIN mastery badge!',
                        details: '5 consecutive calls with complete SPIN sequence:\n‚úÖ Situation questions\n‚úÖ Problem questions\n‚úÖ Implication questions\n‚úÖ Need-Payoff questions',
                        level: 3
                    },
                    {
                        type: 'streak',
                        icon: 'üî•',
                        title: '5-Day Streak',
                        description: 'Consistent execution builds excellence',
                        details: 'Hit baseline 5 days in a row.',
                        level: 1
                    }
                ]
            },
            {
                id: 5,
                name: "Alex Rivera",
                methodology: "Gap Selling",
                dials: 42,
                conversations: 12,
                meetings: 4,
                sales: 1,
                coachingStatus: null,
                achievements: []
            }
        ];

        // Team celebration feed data
        const teamCelebrations = [
            {
                repName: 'Tom Williams',
                icon: 'üèÜ',
                title: 'SPIN Methodology Master Unlocked',
                description: 'Tom executed complete SPIN sequence in 5 consecutive calls. This is mastery.',
                time: '2 hours ago',
                level: 3
            },
            {
                repName: 'Mike Chen',
                icon: 'üí∞',
                title: 'First Sale Closed - $25,000',
                description: 'Mike closed his first deal! TechCorp Solutions, 14-day sales cycle.',
                time: '5 hours ago',
                level: 2
            },
            {
                repName: 'Sarah Johnson',
                icon: 'üî•',
                title: '10-Day Activity Streak',
                description: 'Sarah hit baseline 10 days straight. This is discipline and consistency.',
                time: '1 day ago',
                level: 2
            },
            {
                repName: 'Alex Rivera',
                icon: '‚≠ê',
                title: 'Personal Best - Conversion Rate',
                description: 'Alex hit 29% dial-to-conversation rate, up from 22% last week.',
                time: '1 day ago',
                level: 1
            },
            {
                repName: 'Lisa Park',
                icon: 'üí¨',
                title: 'First Coaching Session',
                description: 'Lisa received her first coaching. Every improvement journey starts here.',
                time: '2 hours ago',
                level: 1
            }
        ];

        // ============================================
        // RADIAL RING DRAWING
        // ============================================

        function drawRadialRings(canvas, metrics) {
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const maxRadius = Math.min(centerX, centerY) - 10;

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Calculate percentages vs expected
            const percentages = {
                dials: Math.min((metrics.dials / EXPECTED_BASELINES.dials) * 100, 100),
                conversations: Math.min((metrics.conversations / EXPECTED_BASELINES.conversations) * 100, 100),
                meetings: Math.min((metrics.meetings / EXPECTED_BASELINES.meetings) * 100, 100),
                sales: Math.min((metrics.sales / EXPECTED_BASELINES.sales) * 100, 100)
            };

            // Ring configuration (outer to inner)
            const rings = [
                {
                    label: 'Dials',
                    percentage: percentages.dials,
                    radius: maxRadius,
                    thickness: 15,
                    color: getColorForPercentage(percentages.dials),
                    bgColor: 'rgba(16, 195, 176, 0.1)'
                },
                {
                    label: 'Conversations',
                    percentage: percentages.conversations,
                    radius: maxRadius - 20,
                    thickness: 15,
                    color: getColorForPercentage(percentages.conversations),
                    bgColor: 'rgba(61, 224, 210, 0.1)'
                },
                {
                    label: 'Meetings',
                    percentage: percentages.meetings,
                    radius: maxRadius - 40,
                    thickness: 15,
                    color: getColorForPercentage(percentages.meetings),
                    bgColor: 'rgba(244, 176, 58, 0.1)'
                },
                {
                    label: 'Sales',
                    percentage: percentages.sales,
                    radius: maxRadius - 60,
                    thickness: 20,
                    color: getColorForPercentage(percentages.sales),
                    bgColor: 'rgba(230, 69, 99, 0.1)'
                }
            ];

            // Draw each ring
            rings.forEach(ring => {
                // Background ring
                ctx.beginPath();
                ctx.arc(centerX, centerY, ring.radius, 0, 2 * Math.PI);
                ctx.strokeStyle = ring.bgColor;
                ctx.lineWidth = ring.thickness;
                ctx.stroke();

                // Progress ring
                const endAngle = -Math.PI / 2 + (2 * Math.PI * ring.percentage / 100);
                ctx.beginPath();
                ctx.arc(centerX, centerY, ring.radius, -Math.PI / 2, endAngle);
                ctx.strokeStyle = ring.color;
                ctx.lineWidth = ring.thickness;
                ctx.lineCap = 'round';
                ctx.stroke();
            });

            // Center icon
            ctx.font = 'bold 32px Arial';
            ctx.fillStyle = percentages.sales >= 75 ? '#10C3B0' : percentages.sales >= 50 ? '#F9C863' : '#E64563';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('üí∞', centerX, centerY);
        }

        function getColorForPercentage(percentage) {
            if (percentage >= 75) return '#10C3B0'; // Green
            if (percentage >= 50) return '#F9C863'; // Yellow
            return '#E64563'; // Red
        }

        // ============================================
        // STATUS CALCULATION
        // ============================================

        function getRepStatus(metrics) {
            const percentages = [
                (metrics.dials / EXPECTED_BASELINES.dials) * 100,
                (metrics.conversations / EXPECTED_BASELINES.conversations) * 100,
                (metrics.meetings / EXPECTED_BASELINES.meetings) * 100,
                (metrics.sales / EXPECTED_BASELINES.sales) * 100
            ];

            const hasRed = percentages.some(p => p < 50);
            const hasYellow = percentages.some(p => p >= 50 && p < 75);

            if (hasRed) return { status: 'critical', icon: 'üî¥' };
            if (hasYellow) return { status: 'watch', icon: 'üü°' };
            return { status: 'healthy', icon: 'üü¢' };
        }

        function getMetricClass(value, expected) {
            const percentage = (value / expected) * 100;
            if (percentage >= 100) return 'good';
            if (percentage >= 75) return 'warning';
            return 'bad';
        }

        function getVsAverage(value, avgValue) {
            const percentage = ((value - avgValue) / avgValue * 100).toFixed(0);
            if (percentage > 0) return `+${percentage}%`;
            return `${percentage}%`;
        }

        // ============================================
        // RENDER REP CARDS
        // ============================================

        function renderRepCards() {
            const grid = document.getElementById('rep-grid');

            grid.innerHTML = demoReps.map(rep => {
                const status = getRepStatus(rep);
                const cardClass = rep.coachingStatus
                    ? (rep.coachingStatus.read ? 'coached-read' : 'coached-unread')
                    : `status-${status.status}`;

                const canvasId = `canvas-${rep.id}`;

                return `
                    <div class="rep-card ${cardClass}">
                        ${renderAchievementBadges(rep)}

                        <!-- Rep Header -->
                        <div class="rep-header">
                            <div class="rep-info">
                                <h3>${rep.name}</h3>
                                <div class="rep-methodology">${rep.methodology}</div>
                            </div>
                            <div class="status-indicator">${status.icon}</div>
                        </div>

                        <!-- Radial Rings -->
                        <div class="radial-container">
                            <canvas id="${canvasId}" class="radial-canvas" width="250" height="250"></canvas>
                        </div>

                        <!-- Metrics Display -->
                        <div class="metrics-display">
                            <div class="metric-item">
                                <span class="metric-label">Dials</span>
                                <span class="metric-value ${getMetricClass(rep.dials, EXPECTED_BASELINES.dials)}">
                                    ${rep.dials}
                                    <span class="metric-vs-avg">${getVsAverage(rep.dials, TEAM_AVERAGE.dials)}</span>
                                </span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Conversations</span>
                                <span class="metric-value ${getMetricClass(rep.conversations, EXPECTED_BASELINES.conversations)}">
                                    ${rep.conversations}
                                    <span class="metric-vs-avg">${getVsAverage(rep.conversations, TEAM_AVERAGE.conversations)}</span>
                                </span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Meetings</span>
                                <span class="metric-value ${getMetricClass(rep.meetings, EXPECTED_BASELINES.meetings)}">
                                    ${rep.meetings}
                                    <span class="metric-vs-avg">${getVsAverage(rep.meetings, TEAM_AVERAGE.meetings)}</span>
                                </span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Sales</span>
                                <span class="metric-value ${getMetricClass(rep.sales, EXPECTED_BASELINES.sales)}">
                                    ${rep.sales}
                                    <span class="metric-vs-avg">${getVsAverage(rep.sales, TEAM_AVERAGE.sales)}</span>
                                </span>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="action-buttons">
                            ${getCoachButton(rep, status)}
                            <button class="btn btn-details" onclick="showRepDetails(${rep.id}); event.stopPropagation();">üìä Details</button>
                        </div>

                        ${rep.coachingStatus ? `
                        <div class="coaching-status ${rep.coachingStatus.read ? 'read' : 'unread'}">
                            ${rep.coachingStatus.read
                                ? `‚úÖ Coaching read ${rep.coachingStatus.sentAt}`
                                : `‚è≥ Coaching sent ${rep.coachingStatus.sentAt} - waiting for read`
                            }
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');

            // Draw canvases after rendering
            setTimeout(() => {
                demoReps.forEach(rep => {
                    const canvas = document.getElementById(`canvas-${rep.id}`);
                    if (canvas) {
                        drawRadialRings(canvas, {
                            dials: rep.dials,
                            conversations: rep.conversations,
                            meetings: rep.meetings,
                            sales: rep.sales
                        });
                    }
                });
            }, 100);
        }

        function getCoachButton(rep, status) {
            if (rep.coachingStatus) {
                if (rep.coachingStatus.read) {
                    return '<button class="btn btn-coached-read">üí¨ Coached ‚úì</button>';
                } else {
                    return '<button class="btn btn-coached-unread">üí¨ Coached ‚è≥</button>';
                }
            }

            if (status.status === 'critical') {
                return `<button class="btn btn-coach urgent" onclick="handleCoachClickById(${rep.id}); event.stopPropagation();">ü§ñ Coach (URGENT)</button>`;
            }

            return `<button class="btn btn-coach" onclick="handleCoachClickById(${rep.id}); event.stopPropagation();">ü§ñ Coach</button>`;
        }

        // ============================================
        // TABLE VIEW
        // ============================================

        let currentSort = { column: null, direction: 'asc' };

        function renderTable() {
            const tableBody = document.getElementById('table-body');

            tableBody.innerHTML = demoReps.map(rep => {
                const status = getRepStatus(rep);
                const rowClass = `row-${status.status}`;

                return `
                    <tr class="${rowClass}">
                        <td>
                            <div class="table-rep-name">${rep.name}</div>
                            <div class="table-methodology">${rep.methodology}</div>
                        </td>
                        <td>${rep.methodology}</td>
                        <td class="table-status">${status.icon}</td>
                        <td class="table-metric ${getMetricClass(rep.dials, EXPECTED_BASELINES.dials)}">
                            ${rep.dials}
                            <span class="table-vs-avg">${getVsAverage(rep.dials, TEAM_AVERAGE.dials)} avg</span>
                        </td>
                        <td class="table-metric ${getMetricClass(rep.conversations, EXPECTED_BASELINES.conversations)}">
                            ${rep.conversations}
                            <span class="table-vs-avg">${getVsAverage(rep.conversations, TEAM_AVERAGE.conversations)} avg</span>
                        </td>
                        <td class="table-metric ${getMetricClass(rep.meetings, EXPECTED_BASELINES.meetings)}">
                            ${rep.meetings}
                            <span class="table-vs-avg">${getVsAverage(rep.meetings, TEAM_AVERAGE.meetings)} avg</span>
                        </td>
                        <td class="table-metric ${getMetricClass(rep.sales, EXPECTED_BASELINES.sales)}">
                            ${rep.sales}
                            <span class="table-vs-avg">${getVsAverage(rep.sales, TEAM_AVERAGE.sales)} avg</span>
                        </td>
                        <td>
                            <div class="table-actions">
                                ${getTableCoachButton(rep, status)}
                                <button class="table-btn table-btn-details" onclick="showRepDetails(${rep.id}); event.stopPropagation();">Details</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getTableCoachButton(rep, status) {
            if (rep.coachingStatus) {
                if (rep.coachingStatus.read) {
                    return '<button class="table-btn table-btn-details">Coached ‚úì</button>';
                } else {
                    return '<button class="table-btn table-btn-coach">Coached ‚è≥</button>';
                }
            }

            const urgentClass = status.status === 'critical' ? ' urgent' : '';
            const urgentText = status.status === 'critical' ? 'URGENT' : 'Coach';
            return `<button class="table-btn table-btn-coach${urgentClass}">ü§ñ ${urgentText}</button>`;
        }

        function sortTable(column) {
            // Update sort state
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            // Update header indicators
            document.querySelectorAll('.performance-table th').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
            });
            const header = Array.from(document.querySelectorAll('.performance-table th'))
                .find(th => th.textContent.toLowerCase().includes(column.toLowerCase()));
            if (header) {
                header.classList.add(currentSort.direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
            }

            // Sort data
            demoReps.sort((a, b) => {
                let aVal, bVal;

                switch(column) {
                    case 'name':
                        aVal = a.name;
                        bVal = b.name;
                        break;
                    case 'methodology':
                        aVal = a.methodology;
                        bVal = b.methodology;
                        break;
                    case 'status':
                        const aStatus = getRepStatus(a).status;
                        const bStatus = getRepStatus(b).status;
                        const statusOrder = { critical: 0, watch: 1, healthy: 2 };
                        aVal = statusOrder[aStatus];
                        bVal = statusOrder[bStatus];
                        break;
                    default:
                        aVal = a[column] || 0;
                        bVal = b[column] || 0;
                }

                if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });

            renderTable();
        }

        // ============================================
        // VIEW SWITCHING
        // ============================================

        function switchView(viewType) {
            // Update toggle buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update view containers
            document.querySelectorAll('.view-container').forEach(container => {
                container.classList.remove('active');
            });

            if (viewType === 'cards') {
                document.getElementById('card-view').classList.add('active');
            } else {
                document.getElementById('table-view').classList.add('active');
                renderTable(); // Render table when switching to it
            }
        }

        // ============================================
        // CELEBRATION SYSTEM
        // ============================================

        function triggerConfetti(level = 1) {
            const count = level === 3 ? 200 : level === 2 ? 100 : 50;
            const duration = level === 3 ? 5000 : level === 2 ? 3000 : 2000;

            const end = Date.now() + duration;

            (function frame() {
                confetti({
                    particleCount: level === 3 ? 7 : 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: ['#10C3B0', '#3DE0D2', '#F4B03A', '#E64563']
                });
                confetti({
                    particleCount: level === 3 ? 7 : 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: ['#10C3B0', '#3DE0D2', '#F4B03A', '#E64563']
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }

        function showCelebrationModal(achievement) {
            const modal = document.getElementById('celebration-modal');
            const icon = document.getElementById('modal-icon');
            const title = document.getElementById('modal-title');
            const description = document.getElementById('modal-description');
            const details = document.getElementById('modal-details');

            icon.textContent = achievement.icon;
            title.textContent = achievement.title;
            description.textContent = achievement.description;
            details.textContent = achievement.details;

            modal.classList.add('active');
            triggerConfetti(achievement.level);
        }

        function closeCelebrationModal() {
            document.getElementById('celebration-modal').classList.remove('active');
        }

        function renderCelebrationFeed() {
            const feedContainer = document.getElementById('celebration-feed-items');

            feedContainer.innerHTML = teamCelebrations.map(celebration => `
                <div class="celebration-item level-${celebration.level}">
                    <div class="celebration-item-header">
                        <div class="celebration-item-title">
                            <span class="celebration-item-icon">${celebration.icon}</span>
                            ${celebration.repName}
                        </div>
                        <div class="celebration-item-time">${celebration.time}</div>
                    </div>
                    <div class="celebration-item-description">
                        <strong>${celebration.title}</strong><br>
                        ${celebration.description}
                    </div>
                </div>
            `).join('');
        }

        function renderAchievementBadges(rep) {
            if (!rep.achievements || rep.achievements.length === 0) {
                return '';
            }

            return `
                <div class="achievement-badges">
                    ${rep.achievements.map((achievement, index) => `
                        <div class="badge ${achievement.type}"
                             onclick="showAchievementById(${rep.id}, ${index}); event.stopPropagation();"
                             title="${achievement.title}">
                            ${achievement.icon}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function showAchievementById(repId, achievementIndex) {
            const rep = demoReps.find(r => r.id === repId);
            if (!rep || !rep.achievements || !rep.achievements[achievementIndex]) {
                console.error('Achievement not found:', repId, achievementIndex);
                return;
            }
            showCelebrationModal(rep.achievements[achievementIndex]);
        }

        function showRepDetails(repId) {
            const rep = demoReps.find(r => r.id === repId);
            if (!rep) {
                console.error('Rep not found:', repId);
                return;
            }

            const status = getRepStatus(rep);
            const convRate = rep.dials > 0 ? Math.round((rep.conversations / rep.dials) * 100) : 0;
            const meetingRate = rep.conversations > 0 ? Math.round((rep.meetings / rep.conversations) * 100) : 0;
            const closeRate = rep.meetings > 0 ? Math.round((rep.sales / rep.meetings) * 100) : 0;

            const detailsModal = {
                icon: 'üìä',
                title: `${rep.name} - Performance Details`,
                description: `${rep.methodology} Methodology ‚Ä¢ ${status.icon} ${status.status.toUpperCase()}`,
                details: `üìà CONVERSION FUNNEL

Dials ‚Üí Conversations: ${convRate}% (${rep.conversations}/${rep.dials})
${convRate >= 30 ? '‚úÖ' : '‚ö†Ô∏è'} Team average: 30%

Conversations ‚Üí Meetings: ${meetingRate}% (${rep.meetings}/${rep.conversations})
${meetingRate >= 33 ? '‚úÖ' : '‚ö†Ô∏è'} Team average: 33%

Meetings ‚Üí Sales: ${closeRate}% (${rep.sales}/${rep.meetings})
${closeRate >= 40 ? '‚úÖ' : '‚ö†Ô∏è'} Team average: 40%

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üéØ ${rep.methodology.toUpperCase()} EXECUTION SCORES

${rep.methodology === 'Sandler' ? `Upfront Contract: 8.5/10
Pain Funnel Depth: 7.5/10
Budget Discussion: 8.0/10
Decision Process: 7.0/10
No Free Consulting: 9.0/10` : ''}${rep.methodology === 'MEDDIC' ? `Metrics Identified: 8/10
Economic Buyer Access: 7/10
Decision Criteria Mapped: 8/10
Decision Process Clarity: 6/10
Identify Pain: 9/10
Champion Developed: 7/10` : ''}${rep.methodology === 'Challenger' ? `Commercial Teaching: 7.5/10
Tailoring Insight: 7/10
Taking Control (Reframe): 6/10
Constructive Tension: 6.5/10
Push for Commitments: 7/10` : ''}${rep.methodology === 'SPIN' ? `Situation Questions: 8/10
Problem Questions: 8.5/10
Implication Questions: 7/10
Need-Payoff Questions: 7.5/10
Question Sequencing: 8/10` : ''}${rep.methodology === 'Gap Selling' ? `Current State Discovery: 8/10
Future State Vision: 7.5/10
Gap Quantification: 7/10
Impact Analysis: 8/10
Problem-Centric Selling: 8.5/10` : ''}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìû RECENT CALL TRANSCRIPTS

${rep.methodology === 'Sandler' || rep.methodology === 'SPIN' ? `‚Ä¢ Jan 10: Discovery call - TechCorp (scored 8.5/10)
‚Ä¢ Jan 9: Follow-up - Innovate Inc (scored 7/10)
‚Ä¢ Jan 8: Cold call - Growth Systems (scored 6.5/10)` : `‚Ä¢ Jan 10: Discovery call (scored 8/10)
‚Ä¢ Jan 9: Follow-up call (scored 7/10)
‚Ä¢ Jan 8: Prospecting call (scored 6.5/10)`}

Click any call to view full transcript and AI analysis.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí° This view shows:
‚Ä¢ Full conversion funnel metrics
‚Ä¢ ${rep.methodology}-specific execution scoring
‚Ä¢ Call-by-call performance tracking
‚Ä¢ Transcript analysis with methodology scoring`,
                level: 1
            };

            showCelebrationModal(detailsModal);
        }

        function handleCoachClickById(repId) {
            // Find the rep by ID
            const rep = demoReps.find(r => r.id === repId);
            if (!rep) {
                console.error('Rep not found:', repId);
                return;
            }

            // Get the rep's status
            const status = getRepStatus(rep);

            // Call the main handler
            handleCoachClick(rep, status);
        }

        function handleCoachClick(rep, status) {
            // Trigger confetti
            triggerConfetti(status.status === 'critical' ? 2 : 1);

            // Generate coaching message based on rep
            let coachingMessage = generateCoachingMessage(rep, status);

            setTimeout(() => {
                showCelebrationModal(coachingMessage);
            }, 500);
        }

        function generateCoachingMessage(rep, status) {
            // Sarah Johnson - Healthy performer (Sandler)
            if (rep.name === "Sarah Johnson") {
                return {
                    icon: 'üéØ',
                    title: 'Coaching: Sarah Johnson',
                    description: 'Performance refinement and advanced techniques',
                    details: `üìä WHAT YOU DID WELL

‚úÖ Activity Consistency ‚Äî 65 dials this week = 130% of baseline. This is your highest activity week on record. 10-day streak shows discipline.

‚úÖ Conversion Quality ‚Äî 31% dial-to-conversation rate vs 30% team average. You're connecting effectively.

‚úÖ Sandler Fundamentals ‚Äî Recent calls show strong upfront contracts and pain funnel execution.

‚ö†Ô∏è WHAT TO REFINE

‚Üí Deal Size Opportunity ‚Äî Average deal: $15K. Top performers in your range close $20-25K deals. You have the activity to support bigger pipeline.

‚Üí Pain Funnel Depth ‚Äî Good pain identification, but could go deeper on personal impact. "What does this mean for you personally?" unlocks bigger urgency.

üéØ SPECIFIC RECOMMENDATIONS

1. TARGET LARGER DEALS: Next 5 conversations, qualify for $20K+ budget. Ask: "Based on what you've shared, is $20-25K within your allocated budget for solving this?"

2. DEEPEN PAIN: When prospect shares business problem, ask: "And what does that mean for you personally if this continues?" Then pause - let them feel it.

3. LEVERAGE YOUR STREAK: You're hot right now. Book 2 extra discovery meetings this week while momentum is high.

üî¨ FOCUS FOR YOUR NEXT CALL

Experiment: Target one $25K+ opportunity.
Ask the personal pain question.
See if urgency increases.

You're executing at a high level. Time to scale the deals. üí™`,
                    level: 1
                };
            }

            // Lisa Park - Critical performer (Challenger)
            if (rep.name === "Lisa Park") {
                return {
                    icon: 'üö®',
                    title: 'URGENT: Coaching for Lisa Park',
                    description: 'Immediate action required - Activity 44% below baseline',
                    details: `üìä CURRENT SITUATION

‚ö†Ô∏è Activity Volume ‚Äî 22 dials vs 50 expected = 44% of baseline
‚ö†Ô∏è Conversion Rate ‚Äî 27% dial-to-conv vs 30% team average
‚ö†Ô∏è Pipeline Impact ‚Äî At this pace, you'll close 0-1 deals this month vs 2 target

This requires immediate attention.

üü¢ WHAT'S WORKING

‚úÖ Meeting Conversion ‚Äî 2 meetings from 6 conversations = 33%. When you get conversations, you're qualifying well.

‚úÖ Challenger Methodology ‚Äî Your last call (Jan 7) showed strong Commercial Teaching. Prospect engaged with your insight.

‚ùå WHAT'S MISSING

‚Üí Activity Discipline ‚Äî 22 dials/week won't build pipeline, regardless of conversion quality. You need 50+ to hit targets.

‚Üí Consistency ‚Äî Activity is sporadic. Mon/Tue you dial, Wed-Fri you disappear. Sales is a daily discipline.

‚Üí Reframe Weakness ‚Äî Jan 7 call: After your teaching, prospect took control. You need to own the conversation.

üéØ IMMEDIATE ACTION PLAN

1. BLOCK DIAL TIME: Tomorrow morning, 9-11 AM ‚Äî 30 dials minimum. No meetings, no email. Just dial.

2. DAILY DISCIPLINE: 10 dials/day minimum = 50/week. Set phone timer for 60 minutes of dial time every morning.

3. REFRAME TECHNIQUE: After you teach, ask: "Given what I've shared, how does this compare to how you're handling it today?" Then pause. Let THEM talk.

4. ACCOUNTABILITY: Report your daily dial count to your manager every day this week.

üî¨ YOUR ONE FOCUS

Activity volume. Everything else is secondary.

You can't coach your way out of 22 dials/week.
Tomorrow: 30 dials. No exceptions. üí™

Need help? Your manager is here to support you.`,
                    level: 2
                };
            }

            // Default coaching message for other reps
            return {
                icon: 'ü§ñ',
                title: `Coaching: ${rep.name}`,
                description: `AI coaching analysis generated`,
                details: `${rep.name} will receive:\n\n‚úÖ Performance analysis based on:\n   ‚Ä¢ ${rep.dials} dials (${getVsAverage(rep.dials, TEAM_AVERAGE.dials)} vs team avg)\n   ‚Ä¢ ${rep.conversations} conversations\n   ‚Ä¢ ${rep.meetings} meetings booked\n   ‚Ä¢ ${rep.sales} sales closed\n\n‚úÖ Methodology-specific recommendations (${rep.methodology})\n\n‚úÖ Focus area for next call\n\nCoaching delivered privately to rep's dashboard.`,
                level: status.status === 'critical' ? 2 : 1
            };
        }

        // ============================================
        // HUBSPOT INTEGRATION
        // ============================================

        const SUPABASE_URL = 'https://qwqlsbccwnwrdpcaccjz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3cWxzYmNjd253cmRwY2FjY2p6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzMTA1MDQsImV4cCI6MjA4MDg4NjUwNH0.yWzSV2Nid_T1XiDE0RrskFob9mRUc-m6MbeIiT7huC4';

        async function loadHubSpotStats() {
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/Synced_Activities?select=activity_type,count`,
                    {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );

                if (!response.ok) throw new Error('Failed to fetch');

                const data = await response.json();

                // Count by activity type
                const counts = { call: 0, email: 0, meeting: 0, task: 0 };
                data.forEach(item => {
                    if (counts.hasOwnProperty(item.activity_type)) {
                        counts[item.activity_type] += item.count || 1;
                    }
                });

                // Update UI
                document.getElementById('hubspot-calls').textContent = counts.call;
                document.getElementById('hubspot-emails').textContent = counts.email;
                document.getElementById('hubspot-meetings').textContent = counts.meeting;
                document.getElementById('hubspot-tasks').textContent = counts.task;
                document.getElementById('last-sync-time').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
                document.getElementById('hubspot-stats').style.display = 'block';

            } catch (error) {
                console.error('Error loading HubSpot stats:', error);
            }
        }

        async function refreshHubSpotData() {
            const btn = document.getElementById('sync-btn');
            btn.textContent = '‚è≥ Syncing...';
            btn.disabled = true;

            try {
                const response = await fetch(
                    `${SUPABASE_URL}/functions/v1/hubspot-sync`,
                    {
                        headers: {
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );

                const result = await response.json();

                if (result.success) {
                    await loadHubSpotStats();
                    triggerConfetti(1);
                    alert(`Synced ${result.totalSynced} activities from HubSpot!`);
                } else {
                    alert('Sync failed: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Sync error: ' + error.message);
            } finally {
                btn.textContent = 'üîÑ Sync HubSpot';
                btn.disabled = false;
            }
        }

        // ============================================
        // FATHOM INTEGRATION
        // ============================================

        async function loadFathomStats() {
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/Synced_Conversations?select=id,transcript,ai_summary&source_provider=eq.fathom`,
                    {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );

                if (!response.ok) throw new Error('Failed to fetch');

                const data = await response.json();

                // Count stats
                const totalCalls = data.length;
                const withTranscripts = data.filter(d => d.transcript).length;
                const withSummaries = data.filter(d => d.ai_summary).length;

                // Update UI
                document.getElementById('fathom-calls').textContent = totalCalls;
                document.getElementById('fathom-transcripts').textContent = withTranscripts;
                document.getElementById('fathom-summaries').textContent = withSummaries;
                document.getElementById('fathom-sync-time').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
                document.getElementById('fathom-stats').style.display = 'block';

            } catch (error) {
                console.error('Error loading Fathom stats:', error);
            }
        }

        async function refreshFathomData() {
            const btn = document.getElementById('fathom-sync-btn');
            btn.textContent = '‚è≥ Syncing...';
            btn.disabled = true;

            try {
                const response = await fetch(
                    `${SUPABASE_URL}/functions/v1/fathom-sync`,
                    {
                        headers: {
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );

                const result = await response.json();

                if (result.success) {
                    await loadFathomStats();
                    triggerConfetti(1);
                    alert(`Synced ${result.results.meetings_synced} call recordings from Fathom!`);
                } else {
                    alert('Sync failed: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Sync error: ' + error.message);
            } finally {
                btn.textContent = 'üîÑ Sync';
                btn.disabled = false;
            }
        }

        // ============================================
        // AIRCALL INTEGRATION
        // ============================================

        async function loadAircallStats() {
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/Synced_Conversations?select=id,recording_url,duration_minutes&source_provider=eq.aircall`,
                    {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );

                if (!response.ok) throw new Error('Failed to fetch');

                const data = await response.json();

                // Count stats
                const totalCalls = data.length;
                const withRecordings = data.filter(d => d.recording_url).length;
                const totalMinutes = data.reduce((sum, d) => sum + (d.duration_minutes || 0), 0);

                // Update UI
                document.getElementById('aircall-total').textContent = totalCalls;
                document.getElementById('aircall-recordings').textContent = withRecordings;
                document.getElementById('aircall-minutes').textContent = totalMinutes;
                document.getElementById('aircall-sync-time').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
                document.getElementById('aircall-stats').style.display = 'block';

            } catch (error) {
                console.error('Error loading Aircall stats:', error);
            }
        }

        async function refreshAircallData() {
            const btn = document.getElementById('aircall-sync-btn');
            btn.textContent = '‚è≥ Syncing...';
            btn.disabled = true;

            try {
                const response = await fetch(
                    `${SUPABASE_URL}/functions/v1/aircall-sync`,
                    {
                        headers: {
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    }
                );

                const result = await response.json();

                if (result.success) {
                    await loadAircallStats();
                    triggerConfetti(1);
                    alert(`Synced ${result.results.calls_synced} phone calls from Aircall!`);
                } else {
                    alert('Sync failed: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Sync error: ' + error.message);
            } finally {
                btn.textContent = 'üîÑ Sync';
                btn.disabled = false;
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        document.addEventListener('DOMContentLoaded', () => {
            renderRepCards();
            renderTable(); // Pre-render table
            renderCelebrationFeed(); // Render team wins feed
            loadHubSpotStats(); // Load HubSpot data
            loadFathomStats(); // Load Fathom data
            loadAircallStats(); // Load Aircall data
        });

    </script>
</body>
</html>
